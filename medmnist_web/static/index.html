<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hackthon-UOI-2025</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Grotesk:wght@500;600;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-orb orb-one"></div>
  <div class="bg-orb orb-two"></div>

  <header class="topbar">
    <div class="brand">
      <svg viewBox="0 0 24 24" aria-hidden="true" class="logo">
        <path d="M12 2l3.5 6 6.5 1-4.7 4.6 1.1 6.4L12 17l-6 3.4 1.1-6.4L2.4 9l6.5-1L12 2z"></path>
      </svg>
      <div class="brand-text">
        <span class="brand-title">Hackathon UOI 2025</span>
        <span class="brand-sub">AI Diagnostics Studio</span>
      </div>
      <span class="badge">demo</span>
    </div>
    <nav class="top-links" aria-label="ŒíŒ±œÉŒπŒ∫œå ŒºŒµŒΩŒøœç">
      <a class="top-link" href="#workspace">Workspace</a>
      <a class="top-link" href="#insights">Info</a>
      <a class="top-link" href="#faq">FAQ</a>
    </nav>
    <button id="themeBtn" class="icon-btn" aria-label="ŒïŒΩŒ±ŒªŒªŒ±Œ≥ŒÆ Œ∏Œ≠ŒºŒ±œÑŒøœÇ">
      <span class="sun">‚òÄÔ∏è</span><span class="moon">üåô</span>
    </button>
  </header>

  <main class="container">
    <section class="hero" id="workspace">
      <div class="hero-copy">
        <span class="eyebrow">404: Disease Not Found</span>
        <h1>Quickly visualize probabilities with one click</h1>
        <p>
          A modern interface for rapid diagnosis of histopathology samples. Upload an image, get predictions from the PathMNIST model, and share secure results with your team.
        </p>
        <ul class="hero-highlights">
          <li>
            <span class="dot"></span>
            <span>Live preview </span>
          </li>
          <li>
            <span class="dot"></span>
            <span>Top-3 probability graphs</span>
          </li>
        </ul>
      </div>
      <div class="hero-panels">
        <div class="status-card">
          <span class="status-label">Dataset</span>
          <strong class="status-value">PathMNIST v3.2</strong>
          <span class="status-desc">Trained on 89k samples</span>
        </div>
        <div class="status-card">
          <span class="status-label">Accuracy Top-1</span>
          <strong class="status-value">94.4%</strong>
          <span class="status-desc">Based on validation set</span>
        </div>
      </div>
    </section>

    <section class="workspace">
      <div class="pane upload">
        <div class="pane-header">
          <h2>Upload X-ray</h2>
          <p class="muted">Drag &amp; Drop, paste (Ctrl/‚åò+V) or ¬´select¬ª.</p>
        </div>
        <div id="dropzone" class="dropzone" tabindex="0" aria-label="Œ†ŒµœÅŒπŒøœáŒÆ ŒºŒµœÑŒ±œÜŒøœÅŒ¨œÇ Œ±œÅœáŒµŒØŒøœÖ">
          <input id="fileInput" type="file" accept="image/*" hidden />
          <div class="drop-inner">
            <div class="drop-icon">‚¨Ü</div>
            <div>
              <button id="browseBtn" class="btn">Select Image</button>
              <span class="hint">or drag here</span>
            </div>
          </div>
          <img id="preview" class="preview hidden" alt="Œ†œÅŒøŒµœÄŒπœÉŒ∫œåœÄŒ∑œÉŒ∑ ŒµŒπŒ∫œåŒΩŒ±œÇ" />
        </div>
        <div class="actions">
          <button id="predictBtn" class="btn primary" disabled>Predict</button>
          <button id="clearBtn" class="btn ghost" disabled>Clear</button>
        </div>
        <div id="progress" class="progress hidden" role="status" aria-live="polite">
          <span class="spinner"></span> Processing...
        </div>
      </div>

      <div class="pane results" id="insights">
        <div class="pane-header">
          <h2>Results</h2>
          <p class="muted">Image classification and model probabilities.</p>
        </div>
        <div id="result" class="result">
          <div class="empty">No prediction has been made yet.</div>
        </div>
        <details id="detailsBox" class="details hidden">
          <summary>Probabilities (top-3)</summary>
          <div id="bars" class="bars"></div>
        </details>
        <div class="tips">
          <h3>Tips</h3>
          <ul>
            <li>Use PNG images.</li>
            <li>Predictions are sent exclusively to the backend API.</li>
          </ul>
        </div>
        <p class="disclaimer">‚ö†Ô∏è Research demonstration ‚Äî not for clinical use.</p>
      </div>
    </section>

    <section class="faq" id="faq">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-grid">
        <article>
          <h3>Where is the forecast performed?</h3>
          <p>The request is sent to the PathMNIST API. We do not store the images, they are only used for estimation.</p>
        </article>
        <article>
          <h3>Can I switch to dark / light mode?</h3>
          <p>Yes! Use the topic button on the top right. Your choice is saved in the browser.</p>
        </article>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>¬© 2025 ‚Äì Hackathon UOI demo</span>
  </footer>

  <script>
    // ŒëŒΩ œÑŒø UI œÉŒµœÅŒ≤ŒØœÅŒµœÑŒ±Œπ Œ±œÄœå œÑŒø ŒØŒ¥ŒπŒø origin ŒºŒµ œÑŒø FastAPI:
    //const API_URL = "/predict";
    // ŒëŒΩ œÑœÅŒ≠œáŒµŒπœÇ ŒæŒµœáœâœÅŒπœÉœÑœå static server: 
    const API_URL = "http://localhost:8080/predict";

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const browseBtn = document.getElementById("browseBtn");
    const predictBtn = document.getElementById("predictBtn");
    const clearBtn = document.getElementById("clearBtn");
    const preview = document.getElementById("preview");
    const progress = document.getElementById("progress");
    const result = document.getElementById("result");
    const bars = document.getElementById("bars");
    const detailsBox = document.getElementById("detailsBox");
    const themeBtn = document.getElementById("themeBtn");

    let currentFile = null;

    // Theme toggle
    const setTheme = (mode) => {
      document.documentElement.dataset.theme = mode;
      localStorage.setItem("ui-theme", mode);
    };
    themeBtn.addEventListener("click", () => {
      const next = (document.documentElement.dataset.theme === "light") ? "dark" : "light";
      setTheme(next);
    });
    setTheme(localStorage.getItem("ui-theme") || "dark");

    // Helpers
    function enableActions(enabled) {
      predictBtn.disabled = !enabled;
      clearBtn.disabled = !enabled;
    }
    function resetUI() {
      currentFile = null;
      preview.src = "";
      preview.classList.add("hidden");
      dropzone.classList.remove("has-image");
      result.innerHTML = `<div class="empty">ŒîŒµŒΩ Œ≠œáŒµŒπ Œ≥ŒØŒΩŒµŒπ Œ±Œ∫œåŒºŒ∑ œÄœÅœåŒ≤ŒªŒµœàŒ∑.</div>`;
      bars.innerHTML = "";
      detailsBox.classList.add("hidden");
      enableActions(false);
    }
    function setPreview(file) {
      const url = URL.createObjectURL(file);
      preview.src = url;
      preview.onload = () => URL.revokeObjectURL(url);
      preview.classList.remove("hidden");
      dropzone.classList.add("has-image");
      enableActions(true);
    }
    function pickFile(file) {
      if (!file || !file.type.startsWith("image/")) {
        alert("Œ†Œ±œÅŒ±Œ∫Œ±Œªœé Œ¥ŒπŒ¨ŒªŒµŒæŒµ Œ±œÅœáŒµŒØŒø ŒµŒπŒ∫œåŒΩŒ±œÇ.");
        return;
      }
      currentFile = file;
      setPreview(file);
    }

    // Drag & Drop
    ["dragenter","dragover"].forEach(ev =>
      dropzone.addEventListener(ev, e => { e.preventDefault(); dropzone.classList.add("drag"); })
    );
    ["dragleave","drop"].forEach(ev =>
      dropzone.addEventListener(ev, e => { e.preventDefault(); dropzone.classList.remove("drag"); })
    );
    dropzone.addEventListener("drop", (e) => {
      const file = e.dataTransfer.files?.[0];
      pickFile(file);
    });

    // Click / Browse
    browseBtn.addEventListener("click", () => fileInput.click());
    dropzone.addEventListener("click", (e) => {
      if (!dropzone.classList.contains("has-image")) fileInput.click();
    });
    fileInput.addEventListener("change", (e) => pickFile(e.target.files?.[0]));

    // Paste (Ctrl/‚åò+V)
    window.addEventListener("paste", (e) => {
      const file = Array.from(e.clipboardData.files || [])[0];
      if (file) pickFile(file);
    });

    // Clear
    clearBtn.addEventListener("click", resetUI);

    // Predict
    predictBtn.addEventListener("click", async () => {
      if (!currentFile) return;
      progress.classList.remove("hidden");
      result.innerHTML = "";
      bars.innerHTML = "";
      detailsBox.classList.add("hidden");

      const form = new FormData();
      form.append("file", currentFile);

      try {
        const resp = await fetch(API_URL, { method: "POST", body: form });
        if (!resp.ok) {
          const err = await resp.json().catch(()=>({detail:"Œ£œÜŒ¨ŒªŒºŒ± server"}));
          throw new Error(err.detail || "Œ£œÜŒ¨ŒªŒºŒ± server");
        }
        const data = await resp.json();

        // ŒöœçœÅŒπŒø Œ∫ŒµŒØŒºŒµŒΩŒø
        const label = Array.isArray(data.pred_class) ? data.pred_class.join(", ") : data.pred_class;
        result.innerHTML = `
          <div class="pred">
            <div class="pred-label">${label ?? "‚Äî"}</div>
          </div>
        `;

        // Top-3 bars (Œ±ŒΩ œÖœÄŒ¨œÅœáŒøœÖŒΩ probs)
        if (data.probs && typeof data.probs === "object") {
          const entries = Object.entries(data.probs);
          entries.sort((a,b) => b[1] - a[1]);
          const top = entries.slice(0, Math.min(3, entries.length));
          top.forEach(([name, p]) => {
            const pct = (p * 100).toFixed(1);
            const row = document.createElement("div");
            row.className = "bar-row";
            row.innerHTML = `
              <div class="bar-label">${name}</div>
              <div class="bar">
                <div class="bar-fill" style="width:${pct}%"></div>
              </div>
              <div class="bar-val">${pct}%</div>
            `;
            bars.appendChild(row);
          });
          detailsBox.classList.remove("hidden");
        }
      } catch (e) {
        result.innerHTML = `<div class="error">‚ùå ${e.message || e}</div>`;
      } finally {
        progress.classList.add("hidden");
      }
    });

    // Init
    resetUI();
  </script>
</body>
</html>
